## Artifact of EvoSpex for Artifact Evaluation at ICSE 2021

EvoSpex: An Evolutionary Algorithm for Learning Postconditions

F. Molina, P. Ponzio, N. Aguirre, and M. Frias.
University of Río Cuarto and CONICET, Argentina.

## Artifact Description

EvoSpex is a tool based on a genetic algorithm for learning postcondition assertions of Java methods. A postcondition assertion is an expression that returns true for correct method executions, and false for incorrect ones. 

Given a Java method, to produce its postcondition EvoSpex recieves as input sets of valid and invalid pre/post state pairs (i.e., state pairs that represent, and do not represent, the method’s current behavior, respectively). Valid pre/post state pairs are obtained by generating executions of the method under analysis, while invalid ones are obtained by mutating the valid pairs. Given these inputs, EvoSpex uses a genetic algorithm to explore the state space of candidate postconditions with the goal of obtaining one that is satisfied by the valid pre/post pairs, while leaving out the invalid ones.

## Paper experiments

To perform the paper experiments and reproduce the evaluation results you must first follow the instructions described in the file [INSTALL.MD](INSTALL.md)

### Measuring the quality of the postconditions

This experiment measures the quality of the postconditions generated by EvoSpex and Daikon on a set of projects that were took from the SF110 benchmark. First, assuming that the target project has been compiled as described in [INSTALL.MD](INSTALL.md), the postconditions need to be generated. 

**NOTE**: the instructions in this section assumes that the project being analyzed is *2_a4j*. The classes and methods to analyze for project *2_a4j* are listed in file *$EVOSPEX/src/test/resources/sf110/2_a4j/target-classes.txt*. To analyze other projects, just use any of the names listed when doing `ls $EVOSPEX/src/test/resources/sf110`. Again, the classes and methods to analyze for a particular project are listed in the file *target-classes.txt* of the corresponding folder. 
 
**Generating postconditions with EvoSpex**

```
  cd $EVOSPEX
  ./experiments/sf110/run-evospex-project.sh 2_a4j 10
``` 

The script will run EvoSpex 10 times for each of the analyzed methods of the project *2_a4j*. Each execution will be stored in the folder *experiments/sf110/2_a4j/evospex-results*.

**Generating postconditions with Daikon**

```
  cd $EVOSPEX
  ./experiments/sf110/run-daikon-project.sh 2_a4j
```

This execution will run Daikon performing the three usual steps described in this [example](http://plse.cs.washington.edu/daikon/download/doc/daikon.html#StackAr-example). As a result, postconditions for each of the target methods will be generated and saved in the folder *experiments/sf110/2_a4j/daikon-results*.

**Quality of the postconditions produced by each technique** 

First, the generated postconditions should be manually placed in the corresponding Java files that will later be the input for OASIs, following the steps described in this [file](extra/COLLECTING_INFERRED_POSTCONDITIONS.md). Since such steps maybe confusing, the Java files already contains the assertions for which the quality was analyzed in the paper, sou you can continue with the next instructions.
 
Now, to analyze the quality of the postconditions we need to provide four arguments:
* the current project
* the class to be analyzed
* the technique (EvoSpex or Daikon) from which the oracles were computed 
* the mode (FP for false positives - FN for false negatives)

So, for example, to detect False Positives in the oracles produced by EvoSpex on class FullProduct of project *2_a4j*, from the folder *$EVOSPEX* run:

```
  ./experiments/sf110/run-oasis-class.sh 2_a4j FullProduct EvoSpex FP
```

and for postconditions produced by Daikon:

```
  ./experiments/sf110/run-oasis-class.sh 2_a4j FullProduct Daikon FP
```

This scripts will try to find False Postivies for the postconditions learned by the corresponding technique. It is important to remark that the assertions in the files corresponding to each technique, namely *$SF110SRC/2_a4j/src/main/java/net/kencochrane/a4j/beans/FullProductEvoSpex.java* and *$SF110SRC/2_a4j/src/main/java/net/kencochrane/a4j/beans/FullProductDaikon.java*, were alreay filtered and do not contain false positives. To perform the analyses from scratch, you should perform the following steps:

1. Edit the file *$SF110SRC/2_a4j/src/main/java/net/kencochrane/a4j/beans/FullProductEvoSpex.java* by including the removed false positives that are described as comments in each of the analyzed methods into the assert statement at the end of method. For instance, the assert statement of method *addAccessory(MiniProduct product)*

```
assert(
  old_thissimilarItems == this.similarItems &&
  ExpressionEvaluator.evaluateSetMembership(product,"this . accessories",this) &&
  this.details != null
);
```

2. Detect False Positives with command `./experiments/sf110/run-oasis-class.sh 2_a4j FullProduct EvoSpex FP`

3. If False Positives are detected, remove the assertion causing it and perform step 2 until no more False Positives are detected. If no False Positives are detected, continue to step 4. 

4. Detect False Negatives with command `./experiments/sf110/run-oasis-class.sh 2_a4j FullProduct EvoSpex FN`

**Note**: exactly the same process should be performed for the file FullProductDaikon, and for every class analyzed for prohect *2_a4j*. At this point, the analysis regarding the quality of the postconditions finishes. 

### Reproducing manually written contracts

This experiment analyzes the reproduction of manually written contractos. 
